<!DOCTYPE html>
<html>

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

<script>
$(document).ready(function(){

   	// from https://docs.djangoproject.com/en/dev/ref/csrf/#ajax
    // Here we fetch the django CSRF (Cross Site Request Forgery) cookie (a nonce??).
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
    		var csrf_token = getCookie('csrftoken');
    		console.log("CSRFTOKEN: " + csrf_token);        	
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });    

    $(".ButtonWrapper").find(":submit").click(function (){
    		console.log("about to make ajax call to endpoint url: http://127.0.0.1:8000/apiperson/mathew/ ");
        $.ajax({ 
            url: "http://127.0.0.1:8000/apiperson/mathew/", 
            type: "GET", 
            jsonp: "callback", 
            success: function(result){
                //nice to stuff this into a table, but that's too hard html just now..
                new_html = "<h2>" + result.last_name + '</h2><p>'+ result.first_name + '<p>' + result.email ;
                console.log(new_html);
                jQuery('#changeme').html(new_html).hide().fadeIn(1500);
            }, 
            error: function(exception){
                var msg = "ajax call failed. Exception responseText:" + exception.responseText + " status:" + exception.status;
                console.log(msg);
                alert(msg);
            },
        }); 

        console.log("after call from  ajax call to endpoint url:    http://127.0.0.1:8000/apiperson/mathew/ " );
    });
});
</script>
</head>

<body>

<div id="changeme"><h2>Let jQuery AJAX Change This Text</h2></div>

<div class="ButtonWrapper">
  <button>Get External Content</button>
</div>

</body>
</html>





